<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Finder - Job Capsule</title>
  <link rel="stylesheet" href="static/styles.css">
</head>
<body>
  <div id="navbar"></div>

  <main>
    <!-- Search Bar -->
    <div class="search-bar">
      <input type="text" id="searchTitle" placeholder="Search by title...">
      <input type="text" id="searchLocation" placeholder="Search by location...">
      <button onclick="filterEvents()">Search</button>
    </div>

    <!-- Event Listings -->
    <div class="event-listings" id="eventList">
      <!-- Event cards will be dynamically added here -->
    </div>
  </main>

  <footer>
    <p>Contact: info@careerhub.com | Phone: +1 234 567 890</p>
    <p><a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a></p>
  </footer>

  <script>
    // Fetch and inject the navbar
    fetch('navbar.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('navbar').innerHTML = data;
      });

    // Fetch events from backend and render them
    function fetchEvents() {
      fetch('/api/events')
        .then(response => response.json())
        .then(data => {
          renderEvents(data); // Render events dynamically
        })
        .catch(error => console.error('Error fetching events:', error));
    }

    // Render Events
    function renderEvents(events) {
      const eventList = document.getElementById('eventList');
      eventList.innerHTML = ''; // Clear previous data

      events.forEach(event => {
        const eventCard = document.createElement('div');
        eventCard.classList.add('event-card');
        eventCard.innerHTML = `
          <h3 class="event-title">${event.title}</h3>
          <p>${event.description}</p>
          <div><strong>Location:</strong> ${event.location}</div>
          <div><strong>Date:</strong> ${event.date}</div>
          <div><strong>Organizer:</strong> ${event.organizer}</div>
          <button class="register-button" ${event.badge === 'Past' ? 'disabled' : ''}>Register Now</button>
        `;
        eventList.appendChild(eventCard);
      });
    }

    // Search Events using API
    function filterEvents() {
      const searchTitle = document.getElementById('searchTitle').value.toLowerCase();
      const searchLocation = document.getElementById('searchLocation').value.toLowerCase();

      fetch(`/api/events/search?query=${searchTitle}&location=${searchLocation}`)
        .then(response => response.json())
        .then(data => {
          renderEvents(data); // Update the event list
        })
        .catch(error => console.error('Error searching events:', error));
    }

    // Fetch Events on Page Load
    fetchEvents();
  </script>
</body>
</html>
